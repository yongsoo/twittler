<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Twittler</title>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/twittler.css">
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <h1>Twittler</h1>
    <ul id="tweetstream"></ul>

    <script>
      $(document).ready(function(){

        var fetchTweets = function() {
          var currentTime = new Date();
          var currentMinutes = currentTime.getMinutes();

          var $tweetstream = $('#tweetstream');
          $tweetstream.html('<li></li>');

          var index = streams.home.length - 1;
          var indexDiff = index - 20;
          while(index >= indexDiff){
            var tweet = streams.home[index];
            var $tweet = $('<li class="tweet"></li>');
            var $tweetMinute = $('<div class="timestamp"></div>');

            var tweetMinute = Math.abs(Number(tweet.created_at.toLocaleTimeString().substr(tweet.created_at.toLocaleTimeString().indexOf(":") + 1, 2) - currentMinutes)) + " min ago";

            if (tweetMinute === "0 min ago") {
              tweetMinute = "now";
            }

            $tweetMinute.text("(" + tweetMinute + ")");

            index -= 1;

            $tweet.text("(" + tweetMinute + ") " + '@' + tweet["user"] + ': ' + tweet["message"]);
            $tweetstream.append($tweet);
          }
        };

        var refresh = function() {
          fetchTweets();
          setTimeout(refresh, 500);
        };

        refresh();

      });
    </script>
  </body>
</html>
