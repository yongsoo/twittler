<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Twittler</title>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/twittler.css">
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <h1>Twittler</h1>
    <div id="stream"></div>

    <script>
      $(document).ready(function(){

        var fetchTweets = function() {
          var currentTime = new Date();
          var currentMinutes = currentTime.getMinutes();

          var $stream = $('#stream');
          $stream.html('');

          var index = streams.home.length - 1;
          var indexDiff = index - 20;

          while(index >= indexDiff) {
            var tweet = streams.home[index];
            var $tweet = $('<li class="tweet"></li>');
            var $tweetMinute = $('<span class="timestamp"></span>');
            var $tweetUser = $('<span class="user"></span>');
            var $tweetMsg = $('<span class="message"></span>');

            var tweetMinute = Math.abs(Number(tweet.created_at.toLocaleTimeString().substr(tweet.created_at.toLocaleTimeString().indexOf(":") + 1, 2) - currentMinutes)) + " min ago";

            if (tweetMinute === "0 min ago") {
              tweetMinute = "now";
            }
            $tweetMinute.text("(" + tweetMinute + ") ");
            $tweetMsg.text(": " + tweet.message);
            $tweetUser.text("@" + tweet.user);

            $stream.append($tweetMinute, $tweetUser, $tweetMsg, '<br><br>');

            index -= 1;

          }
        };

        var refresh = function() {
          fetchTweets();
          setTimeout(refresh, 500);
        };

        refresh();

      });
    </script>
  </body>
</html>
