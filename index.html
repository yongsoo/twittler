<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Twittler</title>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/twittler.css">
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <h1>Twittler</h1>
    <ul id="tweetstream"></ul>
    <div id="timestamp"></div>

    <script>
      $(document).ready(function(){

        var fetchTweets = function() {
          var currentTime = new Date();
          var currentMinutes = currentTime.getMinutes();

          var $tweetstream = $('#tweetstream');
          $tweetstream.html('<li></li>');
          var $createdAt = $('#timestamp');
          $createdAt.html('<div></div>');


          var index = streams.home.length - 1;
          var indexDiff = index - 20;
          while(index >= indexDiff){
            var tweet = streams.home[index];
            var $tweet = $('<li class="tweet"></li>');

            var tweetMinute = Number(Math.abs(tweet.created_at.toLocaleTimeString().slice(3, 5) - currentMinutes));

            index -= 1;

            // This needs to be the last thing that happens
            $tweet.text("(" + tweetMinute + " min ago) " + '@' + tweet["user"] + ': ' + tweet["message"]);
            $tweetstream.append($tweet);
          }
        };

        var refresh = function() {
          fetchTweets();
          setTimeout(refresh, 500);
        };

        refresh();

      });
    </script>
  </body>
</html>
